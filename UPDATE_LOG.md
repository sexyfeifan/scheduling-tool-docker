# 更新日志

## 版本 2.12 (2026-02-14)

### 新增功能
- 删除日程后空状态显示：修复删除日程后不显示"🈚️"的问题
- 备份恢复密码保护：数据备份与恢复功能需要密码才能访问
- 密码配置：可通过环境变量 `BACKUP_PASSWORD` 设置（默认密码：admin123）

### Bug修复
- 修复数据持久化问题：将 Docker 命名卷改为 bind mount，数据存储在宿主机的 `./data` 文件夹
- 修复版本号显示问题：确保 Docker 构建时正确读取 version.json

### 技术改进
- docker-compose.yml：将 `scheduling-data` 命名卷改为 `./data` bind mount
- style.css：删除 `@media (prefers-color-scheme: dark)` 暗色模式 CSS
- 新增 `data` 文件夹：用于存储排期数据和设置文件

### 部署说明
- **重要**：旧版本使用命名卷，重新部署前需删除旧卷：
  ```bash
  docker volume rm scheduling-tool-data_scheduling-data
  ```
- 新版本数据存储在宿主机的 `./data` 目录
- 如需清空数据，删除 `./data` 文件夹内容即可
- 如需保留数据迁移到新版本，先备份再部署

---

## 版本 2.11 (2026-02-14)

### 新增功能
- 移除深色模式：删除系统级别的暗色模式跟随功能，始终显示浅色模式

### Bug修复
- 修复数据持久化问题：将 Docker 命名卷改为 bind mount，数据存储在宿主机的 `./data` 文件夹
- 修复版本号显示问题：确保 Docker 构建时正确读取 version.json

### 技术改进
- docker-compose.yml：将 `scheduling-data` 命名卷改为 `./data` bind mount
- style.css：删除 `@media (prefers-color-scheme: dark)` 暗色模式 CSS
- 新增 `data` 文件夹：用于存储排期数据和设置文件

### 部署说明
- **重要**：旧版本使用命名卷，重新部署前需删除旧卷：
  ```bash
  docker volume rm scheduling-tool-data_scheduling-data
  ```
- 新版本数据存储在宿主机的 `./data` 目录
- 如需清空数据，删除 `./data` 文件夹内容即可
- 如需保留数据迁移到新版本，先备份再部署

---

## 版本 2.10 (2026-02-14)

### 新增功能
- 导出图片样式优化：标题改为深灰色文字配合白色毛玻璃背景，与编辑页面底色一致
- 动态版本号显示：从 version.json 文件读取实际版本号，左上角显示实时版本信息
- 独立备份恢复板块：在设置页面中添加专门的备份恢复功能区域
- 一键备份到宿主机：支持将数据备份到 Docker 映射的宿主机目录
- 从宿主机恢复：支持从备份目录选择文件进行数据恢复

### Bug修复
- 修复版本号显示 v1.0 的问题：更新默认版本号为 2.10，确保 Docker 容器中正确读取版本文件
- 修复备份文件不显示在 backups 文件夹的问题：添加环境变量 BACKUP_DIR 确保路径正确
- 修复 Dockerfile 中 version.json 未预置的问题：添加 RUN 指令确保版本文件存在

### 技术改进
- Dockerfile：添加创建 backups 目录和确保 version.json 存在的指令
- docker-compose.yml：添加 BACKUP_DIR 环境变量配置
- server.js：更新默认版本号为 2.10
- main.js：导出图片标题样式改为深灰色 #1d1d1f

### 部署说明
- 使用新版本部署后，左上角将显示正确的版本号 v2.10
- 备份文件将正确保存到 ./backups 目录

---

## 版本 2.9 (2026-02-14)

### 新增功能
- 导出图片底色修改：与编辑页面底色一致，浅灰色 #f5f5f7

### Bug修复
- 修复导出页面标题底色为蓝紫色渐变问题

---

## 版本 2.8 (2026-02-14)

### 新增功能
- docker-compose.yml 添加 backups 目录映射

---

## 版本 2.7 (2026-02-14)

### 新增功能
- 动态版本号显示功能
- 独立备份恢复板块
- 一键备份到宿主机功能
- 从宿主机选择备份恢复功能

---

## 版本 2.6 (2026-02-14)

### 新增功能
- 手机端日期点击切换显示特定日期日程
- 手机端打开默认显示当日

---

## 版本 2.5 (2026-02-14)

### 新增功能
- 设置弹窗滚动修复
- 复制功能支持跨周选择日期
- 导出图片风格统一为 Apple 现代化风格

---

## 版本 2.0 - 2.4 (2026-02-14)

### 新增功能
- 移动端优化和自适应显示
- 飞牛 OS 部署教程

---

## 版本 1.16.1 (2025-12-13)

### 新增功能
- 为主页面"运营"和"声音"显示设置添加颜色
- 为"运营"(operational)设置添加靛蓝色背景和深蓝色文字
- 为"声音"(audio)设置添加玫红色背景和深粉色文字
- 确保新颜色与现有其他设置项颜色不重复，保持视觉一致性

### 技术改进
- 运营(operational): 背景色 #e8eaf6，文字色 #3f51b5
- 声音(audio): 背景色 #fce4ec，文字色 #c2185b
- 与现有颜色方案保持协调统一

### 部署说明
本次更新需要替换以下文件：
1. `client/css/style.css` - 更新了样式文件以支持新的颜色

对于Docker部署，可以直接使用新的镜像构建，或手动替换容器内的文件。

---

## 版本 1.16 (2025-12-XX)

### 新增功能
1. **新增运营和录音设置项**
   - 在设置界面新增"运营"和"录音"两个设置项，位于"研发"设置项下方
   - 参考"研发"设置项的参数和显示方式实现

2. **项目编辑表单增强**
   - 在项目编辑表单中添加"运营"和"录音"选择项
   - 支持多选功能，与其它人员选择项保持一致

3. **数据模型更新**
   - 更新服务器端 Setting 模型，添加 commonOperationalFacilities 和 commonAudioFacilities 字段
   - 更新客户端 JavaScript 代码，支持新字段的读取和保存

4. **界面显示优化**
   - 在项目卡片中显示运营和录音人员信息
   - 保持与其它人员信息一致的显示风格

### Bug修复
1. **拖拽功能稳定性提升**
   - 增加数据验证和边界检查，防止拖拽过程中出现程序崩溃
   - 优化错误处理机制，提供更友好的错误提示

### 技术改进
1. **代码结构优化**
   - 完善了前后端对新设置项的支持
   - 统一了设置项的处理逻辑，提高代码可维护性

---

## 版本 1.1 (2025-12-02)

### 新增功能
- 添加只读预览页面，访问路径: `/date`
- 预览页面提供与主页面相同的数据展示，但禁止所有编辑操作
- 预览页面支持实时数据同步，当主页面数据发生变化时，预览页面会自动更新
- 预览页面包含独立的周导航控件

### 功能说明
1. **主编辑页面**: `http://localhost:3000` - 完整功能，支持所有编辑操作
2. **只读预览页面**: `http://localhost:3000/date` - 仅查看功能，无法进行任何修改

### 技术实现
- 预览页面使用独立的HTML文件 (`preview.html`)
- 共享相同的CSS样式文件以保证视觉一致性
- 通过Server-Sent Events (SSE)实现实时数据同步
- 预览页面禁用了所有编辑相关的交互元素
- 预览页面添加了实时更新提示功能

### 使用场景
- 团队成员查看排期信息而不意外修改
- 在大屏幕显示器上展示当前排期
- 作为公共信息展示页面
- 防止非授权人员修改排期数据

### 部署说明
本次更新无需重新部署，只需替换以下文件：
1. `server/server.js` - 更新了路由以支持预览页面
2. `client/preview.html` - 新增的预览页面文件

对于Docker部署，可以直接使用新的镜像构建，或手动替换容器内的文件。